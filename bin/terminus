#!/usr/bin/env ruby

require 'rubygems'
require 'readline'
require 'oyster'
require File.dirname(__FILE__) + '/../lib/terminus'

spec = Oyster.spec do
  name "terminus -- controll web browsers from the command line"
  synopsis "terminus [--port PORT]"
  
  integer :port, :default => Terminus::DEFAULT_PORT
end

begin
  options = spec.parse
  app = Terminus.create(options)
  
  app.run!
  puts "Terminus server running on port #{options[:port]}"
  puts "Press CTRL-C to exit"
  
  trap("INT") { app.stop! ; exit }
  
  puts ""
  puts "This is the Terminus console. You can type JavaScript"
  puts "in here and it will be executed on all connected pages."
  puts ""
  
  loop {
    script, result = Readline.readline('>> '), nil
    Readline::HISTORY.push(script)
    app.execute(script) { |r| result = r }
  }
  
rescue Oyster::HelpRendered
end

