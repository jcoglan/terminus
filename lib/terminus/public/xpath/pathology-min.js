var Pathology={evaluate:function(c,a,e,d,h){h=h||new Pathology.XPathResult(d);var b=Pathology.XPathParser.parse(c);b.evaluate(a,a,d,h);return h},atomize:function(c,a,e){var d=c.evaluate(a,e);if(d&&d.atomize)d=d.atomize();return d},array:function(c){if(!c)return[];var a=[],e=c.length;while(e--)a[e]=c[e];return a}};if(typeof XPathResult==='undefined'){XPathResult={ANY_TYPE:0,NUMBER_TYPE:1,STRING_TYPE:2,BOOLEAN_TYPE:3,UNORDERED_NODE_ITERATOR_TYPE:4,ORDERED_NODE_ITERATOR_TYPE:5,UNORDERED_NODE_SNAPSHOT_TYPE:6,ORDERED_NODE_SNAPSHOT_TYPE:7,ANY_UNORDERED_NODE_TYPE:8,FIRST_ORDERED_NODE_TYPE:9}}if(typeof document.evaluate==='undefined'){document.evaluate=function(){return Pathology.evaluate.apply(Pathology,arguments)}}Pathology.XPathResult=function(c){this._4=c;this._3=[];this._5=0};Pathology.XPathResult.prototype.push=function(c){if(this._4!==0&&c.nodeType!==this._4)return;if(this._3.indexOf(c)>=0)return;this._3.push(c)};Pathology.XPathResult.prototype.iterateNext=function(){var c=this._3[this._5];if(!c)return null;this._5+=1;return c};Pathology.XPathResult.prototype.forEach=function(c,a){for(var e=0,d=this._3.length;e<d;e++)c.call(a,this._3[e],e)};Pathology.XPathResult.prototype.atomize=function(){if(this._3.length===0)return null;if(this._3.length===1){var c=this._3[0];if(c.nodeValue===undefined||c.nodeValue===null)return c;return c.nodeValue}else{var a=[];for(var e=0,d=this._3.length;e<d;e++)a.push(this._3[e].nodeValue);return a}};Pathology.XPathResult.prototype.makeString=function(){var a=this._3[0];if(!a)return'';switch(a.nodeType){case XPathResult.STRING_TYPE:return this.atomize();case XPathResult.BOOLEAN_TYPE:var e=[];this.forEach(function(c){e.push(c.nodeValue)});return e.join('');default:var d=document.evaluate('//text()',a,null,XPathResult.ANY_TYPE,null);return d.makeString()}};(function(){var k=function(c,a){if(!c||!a)return c;for(var e in a){if(c[e]!==a[e])c[e]=a[e]}return c};var G=function(c,a){var e=a.split('.'),d;while(d=e.shift()){c=c[d];if(c===undefined)throw new Error('Cannot find object named '+a);}return c};var bl=function(c){var a=c.input.split(/\n/g),e=0,d=0;while(d<c.offset+1){d+=a[e].length+1;e+=1}var h='Line '+e+': expected '+c.expected+'\n',b=a[e-1];h+=b+'\n';d-=b.length+1;while(d<c.offset){h+=' ';d+=1}return h+'^'};var bd={__consume__union_expression:function(c){var a=null,e=this._0;this._2["union_expression"]=this._2["union_expression"]||{};var d=this._2["union_expression"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0,b=[],g={},j="";var f=null;f=this.__consume__location_path();if(f){b.push(f);j+=f.textValue;g.head=f;var i=null;var m=0,p=this._0,q=[],o="",l=true;while(l){var n=this._0,r=[],u={},w="";var s=null;s=this.__consume__space();if(s){r.push(s);w+=s.textValue;u.space=s;var t=null;var v=null;if(this._1.length>this._0){v=this._1.substring(this._0,this._0+1)}else{v=null}if(v==="|"){var y=this.constructor.SyntaxNode;var z=null;t=new y("|",this._0,[]);if(typeof z==="object"){k(t,z)}this._0+=1}else{t=null;var A=null;if(this._1.length>this._0){A=this._1.substring(this._0,this._0+1)}else{A=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"|\""}}}if(t){r.push(t);w+=t.textValue;var x=null;x=this.__consume__space();if(x){r.push(x);w+=x.textValue;u.space=x;var B=null;B=this.__consume__location_path();if(B){r.push(B);w+=B.textValue;u.location_path=B}else{r=null;this._0=n}}else{r=null;this._0=n}}else{r=null;this._0=n}}else{r=null;this._0=n}if(r){this._0=n;var E=this.constructor.SyntaxNode;var D=null;l=new E(w,this._0,r,u);if(typeof D==="object"){k(l,D)}this._0+=w.length}else{l=null}if(l){q.push(l);o+=l.textValue;m-=1}}if(m<=0){this._0=p;var H=this.constructor.SyntaxNode;var C=null;i=new H(o,this._0,q);if(typeof C==="object"){k(i,C)}this._0+=o.length}else{i=null}if(i){b.push(i);j+=i.textValue;g.rest=i}else{b=null;this._0=h}}else{b=null;this._0=h}if(b){this._0=h;var I=this.constructor.SyntaxNode;var J=G(this.constructor,"Union");a=new I(j,this._0,b,g);if(typeof J==="object"){k(a,J)}this._0+=j.length}else{a=null}return this._2["union_expression"][e]=a},__consume__location_path:function(c){var a=null,e=this._0;this._2["location_path"]=this._2["location_path"]||{};var d=this._2["location_path"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0,b=[],g={},j="";var f=null;f=this.__consume__location_step();if(f){b.push(f);j+=f.textValue;g.head=f;var i=null;var m=0,p=this._0,q=[],o="",l=true;while(l){l=this.__consume__location_step();if(l){q.push(l);o+=l.textValue;m-=1}}if(m<=0){this._0=p;var n=this.constructor.SyntaxNode;var r=null;i=new n(o,this._0,q);if(typeof r==="object"){k(i,r)}this._0+=o.length}else{i=null}if(i){b.push(i);j+=i.textValue;g.rest=i}else{b=null;this._0=h}}else{b=null;this._0=h}if(b){this._0=h;var u=this.constructor.SyntaxNode;var w=G(this.constructor,"LocationPath");a=new u(j,this._0,b,g);if(typeof w==="object"){k(a,w)}this._0+=j.length}else{a=null}return this._2["location_path"][e]=a},__consume__location_step:function(c){var a=null,e=this._0;this._2["location_step"]=this._2["location_step"]||{};var d=this._2["location_step"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0,b=[],g={},j="";var f=null;var i=this._0;var m=null;if(this._1.length>this._0){m=this._1.substring(this._0,this._0+1)}else{m=null}if(m==="/"){var p=this.constructor.SyntaxNode;var q=null;f=new p("/",this._0,[]);if(typeof q==="object"){k(f,q)}this._0+=1}else{f=null;var o=null;if(this._1.length>this._0){o=this._1.substring(this._0,this._0+1)}else{o=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"/\""}}}if(f){}else{this._0=i;var l=this.constructor.SyntaxNode;var n=null;f=new l("",this._0,[]);if(typeof n==="object"){k(f,n)}this._0+=0}if(f){b.push(f);j+=f.textValue;var r=null;var u=this._0;var w=this._0,s=[],t={},v="";var y=null;y=this.__consume__axis();if(y){s.push(y);v+=y.textValue;t.axis=y;var z=null;var A=this._0;z=this.__consume__node_test();if(z){}else{this._0=A;var x=this.constructor.SyntaxNode;var B=null;z=new x("",this._0,[]);if(typeof B==="object"){k(z,B)}this._0+=0}if(z){s.push(z);v+=z.textValue;t.test=z}else{s=null;this._0=w}}else{s=null;this._0=w}if(s){this._0=w;var E=this.constructor.SyntaxNode;var D=null;r=new E(v,this._0,s,t);if(typeof D==="object"){k(r,D)}this._0+=v.length}else{r=null}if(r){}else{this._0=u;var H=this._0,C=[],I={},J="";var F=null;var bm=this._0;F=this.__consume__axis();if(F){}else{this._0=bm;var be=this.constructor.SyntaxNode;var bf=null;F=new be("",this._0,[]);if(typeof bf==="object"){k(F,bf)}this._0+=0}if(F){C.push(F);J+=F.textValue;I.axis=F;var P=null;P=this.__consume__node_test();if(P){C.push(P);J+=P.textValue;I.test=P}else{C=null;this._0=H}}else{C=null;this._0=H}if(C){this._0=H;var R=this.constructor.SyntaxNode;var bg=null;r=new R(J,this._0,C,I);if(typeof bg==="object"){k(r,bg)}this._0+=J.length}else{r=null}if(r){}else{this._0=u}}if(r){b.push(r);j+=r.textValue;g.selector=r;var L=null;var Y=0,bn=this._0,Z=[],M="",N=true;while(N){N=this.__consume__node_predicate();if(N){Z.push(N);M+=N.textValue;Y-=1}}if(Y<=0){this._0=bn;var bo=this.constructor.SyntaxNode;var ba=null;L=new bo(M,this._0,Z);if(typeof ba==="object"){k(L,ba)}this._0+=M.length}else{L=null}if(L){b.push(L);j+=L.textValue;g.predicates=L}else{b=null;this._0=h}}else{b=null;this._0=h}}else{b=null;this._0=h}if(b){this._0=h;var bh=this.constructor.SyntaxNode;var bi=G(this.constructor,"LocationStep");a=new bh(j,this._0,b,g);if(typeof bi==="object"){k(a,bi)}this._0+=j.length}else{a=null}return this._2["location_step"][e]=a},__consume__axis:function(c){var a=null,e=this._0;this._2["axis"]=this._2["axis"]||{};var d=this._2["axis"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0;var b=this._0,g=[],j={},f="";var i=null;var m=1,p=this._0,q=[],o="",l=true;while(l){var n=null;if(this._1.length>this._0){n=this._1.substring(this._0,this._0+1)}else{n=null}if(n&&/^[a-z\-]/.test(n)){var r=this.constructor.SyntaxNode;var u=null;l=new r(n,this._0,[]);if(typeof u==="object"){k(l,u)}this._0+=1}else{l=null;var w=null;if(this._1.length>this._0){w=this._1.substring(this._0,this._0+1)}else{w=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"[a-z\\-]"}}}if(l){q.push(l);o+=l.textValue;m-=1}}if(m<=0){this._0=p;var s=this.constructor.SyntaxNode;var t=null;i=new s(o,this._0,q);if(typeof t==="object"){k(i,t)}this._0+=o.length}else{i=null}if(i){g.push(i);f+=i.textValue;j.axis_name=i;var v=null;var y=null;if(this._1.length>this._0){y=this._1.substring(this._0,this._0+2)}else{y=null}if(y==="::"){var z=this.constructor.SyntaxNode;var A=null;v=new z("::",this._0,[]);if(typeof A==="object"){k(v,A)}this._0+=2}else{v=null;var x=null;if(this._1.length>this._0){x=this._1.substring(this._0,this._0+1)}else{x=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"::\""}}}if(v){g.push(v);f+=v.textValue}else{g=null;this._0=b}}else{g=null;this._0=b}if(g){this._0=b;var B=this.constructor.SyntaxNode;var E=null;a=new B(f,this._0,g,j);if(typeof E==="object"){k(a,E)}this._0+=f.length}else{a=null}if(a){}else{this._0=h;a=this.__consume__axis_shorthand();if(a){}else{this._0=h}}return this._2["axis"][e]=a},__consume__axis_shorthand:function(c){var a=null,e=this._0;this._2["axis_shorthand"]=this._2["axis_shorthand"]||{};var d=this._2["axis_shorthand"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0;var b=null;if(this._1.length>this._0){b=this._1.substring(this._0,this._0+1)}else{b=null}if(b==="@"){var g=this.constructor.SyntaxNode;var j=null;a=new g("@",this._0,[]);if(typeof j==="object"){k(a,j)}this._0+=1}else{a=null;var f=null;if(this._1.length>this._0){f=this._1.substring(this._0,this._0+1)}else{f=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"@\""}}}if(a){}else{this._0=h;var i=null;if(this._1.length>this._0){i=this._1.substring(this._0,this._0+2)}else{i=null}if(i===".."){var m=this.constructor.SyntaxNode;var p=null;a=new m("..",this._0,[]);if(typeof p==="object"){k(a,p)}this._0+=2}else{a=null;var q=null;if(this._1.length>this._0){q=this._1.substring(this._0,this._0+1)}else{q=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"..\""}}}if(a){}else{this._0=h;var o=null;if(this._1.length>this._0){o=this._1.substring(this._0,this._0+1)}else{o=null}if(o==="."){var l=this.constructor.SyntaxNode;var n=null;a=new l(".",this._0,[]);if(typeof n==="object"){k(a,n)}this._0+=1}else{a=null;var r=null;if(this._1.length>this._0){r=this._1.substring(this._0,this._0+1)}else{r=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\".\""}}}if(a){}else{this._0=h;var u=null;if(this._1.length>this._0){u=this._1.substring(this._0,this._0+1)}else{u=null}if(u==="/"){var w=this.constructor.SyntaxNode;var s=null;a=new w("/",this._0,[]);if(typeof s==="object"){k(a,s)}this._0+=1}else{a=null;var t=null;if(this._1.length>this._0){t=this._1.substring(this._0,this._0+1)}else{t=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"/\""}}}if(a){}else{this._0=h}}}}return this._2["axis_shorthand"][e]=a},__consume__node_test:function(c){var a=null,e=this._0;this._2["node_test"]=this._2["node_test"]||{};var d=this._2["node_test"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0;a=this.__consume__node_condition();if(a){var b=G(this.constructor,"NodeTest");if(typeof b==="object"){k(a,b)}}else{this._0=h;a=this.__consume__node_name();if(a){var g=G(this.constructor,"NodeTest");if(typeof g==="object"){k(a,g)}}else{this._0=h;var j=null;if(this._1.length>this._0){j=this._1.substring(this._0,this._0+1)}else{j=null}if(j==="*"){var f=this.constructor.SyntaxNode;var i=null;a=new f("*",this._0,[]);if(typeof i==="object"){k(a,i)}this._0+=1}else{a=null;var m=null;if(this._1.length>this._0){m=this._1.substring(this._0,this._0+1)}else{m=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"*\""}}}if(a){var p=G(this.constructor,"NodeTest");if(typeof p==="object"){k(a,p)}}else{this._0=h}}}return this._2["node_test"][e]=a},__consume__node_condition:function(c){var a=null,e=this._0;this._2["node_condition"]=this._2["node_condition"]||{};var d=this._2["node_condition"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0,b=[],g={},j="";var f=null;var i=1,m=this._0,p=[],q="",o=true;while(o){var l=null;if(this._1.length>this._0){l=this._1.substring(this._0,this._0+1)}else{l=null}if(l&&/^[a-z\-]/.test(l)){var n=this.constructor.SyntaxNode;var r=null;o=new n(l,this._0,[]);if(typeof r==="object"){k(o,r)}this._0+=1}else{o=null;var u=null;if(this._1.length>this._0){u=this._1.substring(this._0,this._0+1)}else{u=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"[a-z\\-]"}}}if(o){p.push(o);q+=o.textValue;i-=1}}if(i<=0){this._0=m;var w=this.constructor.SyntaxNode;var s=null;f=new w(q,this._0,p);if(typeof s==="object"){k(f,s)}this._0+=q.length}else{f=null}if(f){b.push(f);j+=f.textValue;g.condition_name=f;var t=null;var v=null;if(this._1.length>this._0){v=this._1.substring(this._0,this._0+2)}else{v=null}if(v==="()"){var y=this.constructor.SyntaxNode;var z=null;t=new y("()",this._0,[]);if(typeof z==="object"){k(t,z)}this._0+=2}else{t=null;var A=null;if(this._1.length>this._0){A=this._1.substring(this._0,this._0+1)}else{A=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"()\""}}}if(t){b.push(t);j+=t.textValue}else{b=null;this._0=h}}else{b=null;this._0=h}if(b){this._0=h;var x=this.constructor.SyntaxNode;var B=null;a=new x(j,this._0,b,g);if(typeof B==="object"){k(a,B)}this._0+=j.length}else{a=null}return this._2["node_condition"][e]=a},__consume__node_name:function(c){var a=null,e=this._0;this._2["node_name"]=this._2["node_name"]||{};var d=this._2["node_name"][e];if(d){this._0+=d.textValue.length;return d}var h=1,b=this._0,g=[],j="",f=true;while(f){var i=null;if(this._1.length>this._0){i=this._1.substring(this._0,this._0+1)}else{i=null}if(i&&/^[A-Za-z0-9\-]/.test(i)){var m=this.constructor.SyntaxNode;var p=null;f=new m(i,this._0,[]);if(typeof p==="object"){k(f,p)}this._0+=1}else{f=null;var q=null;if(this._1.length>this._0){q=this._1.substring(this._0,this._0+1)}else{q=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"[A-Za-z0-9\\-]"}}}if(f){g.push(f);j+=f.textValue;h-=1}}if(h<=0){this._0=b;var o=this.constructor.SyntaxNode;var l=null;a=new o(j,this._0,g);if(typeof l==="object"){k(a,l)}this._0+=j.length}else{a=null}return this._2["node_name"][e]=a},__consume__node_predicate:function(c){var a=null,e=this._0;this._2["node_predicate"]=this._2["node_predicate"]||{};var d=this._2["node_predicate"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0,b=[],g={},j="";var f=null;var i=null;if(this._1.length>this._0){i=this._1.substring(this._0,this._0+1)}else{i=null}if(i==="["){var m=this.constructor.SyntaxNode;var p=null;f=new m("[",this._0,[]);if(typeof p==="object"){k(f,p)}this._0+=1}else{f=null;var q=null;if(this._1.length>this._0){q=this._1.substring(this._0,this._0+1)}else{q=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"[\""}}}if(f){b.push(f);j+=f.textValue;var o=null;o=this.__consume__expression();if(o){b.push(o);j+=o.textValue;g.expression=o;var l=null;var n=null;if(this._1.length>this._0){n=this._1.substring(this._0,this._0+1)}else{n=null}if(n==="]"){var r=this.constructor.SyntaxNode;var u=null;l=new r("]",this._0,[]);if(typeof u==="object"){k(l,u)}this._0+=1}else{l=null;var w=null;if(this._1.length>this._0){w=this._1.substring(this._0,this._0+1)}else{w=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"]\""}}}if(l){b.push(l);j+=l.textValue}else{b=null;this._0=h}}else{b=null;this._0=h}}else{b=null;this._0=h}if(b){this._0=h;var s=this.constructor.SyntaxNode;var t=null;a=new s(j,this._0,b,g);if(typeof t==="object"){k(a,t)}this._0+=j.length}else{a=null}return this._2["node_predicate"][e]=a},__consume__expression:function(c){var a=null,e=this._0;this._2["expression"]=this._2["expression"]||{};var d=this._2["expression"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0;a=this.__consume__or_expression();if(a){}else{this._0=h;a=this.__consume__and_expression();if(a){}else{this._0=h;a=this.__consume__comparison();if(a){}else{this._0=h;a=this.__consume__atom();if(a){}else{this._0=h}}}}return this._2["expression"][e]=a},__consume__or_expression:function(c){var a=null,e=this._0;this._2["or_expression"]=this._2["or_expression"]||{};var d=this._2["or_expression"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0;var b=this._0,g=[],j={},f="";var i=null;i=this.__consume__and_expression();if(i){g.push(i);f+=i.textValue;j.left=i;var m=null;var p=null;if(this._1.length>this._0){p=this._1.substring(this._0,this._0+2)}else{p=null}if(p==="or"){var q=this.constructor.SyntaxNode;var o=null;m=new q("or",this._0,[]);if(typeof o==="object"){k(m,o)}this._0+=2}else{m=null;var l=null;if(this._1.length>this._0){l=this._1.substring(this._0,this._0+1)}else{l=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"or\""}}}if(m){g.push(m);f+=m.textValue;var n=null;n=this.__consume__or_expression();if(n){g.push(n);f+=n.textValue;j.right=n}else{g=null;this._0=b}}else{g=null;this._0=b}}else{g=null;this._0=b}if(g){this._0=b;var r=this.constructor.SyntaxNode;var u=G(this.constructor,"Or");a=new r(f,this._0,g,j);if(typeof u==="object"){k(a,u)}this._0+=f.length}else{a=null}if(a){}else{this._0=h;a=this.__consume__and_expression();if(a){}else{this._0=h}}return this._2["or_expression"][e]=a},__consume__and_expression:function(c){var a=null,e=this._0;this._2["and_expression"]=this._2["and_expression"]||{};var d=this._2["and_expression"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0;var b=this._0,g=[],j={},f="";var i=null;i=this.__consume__comparison();if(i){g.push(i);f+=i.textValue;j.left=i;var m=null;var p=null;if(this._1.length>this._0){p=this._1.substring(this._0,this._0+3)}else{p=null}if(p==="and"){var q=this.constructor.SyntaxNode;var o=null;m=new q("and",this._0,[]);if(typeof o==="object"){k(m,o)}this._0+=3}else{m=null;var l=null;if(this._1.length>this._0){l=this._1.substring(this._0,this._0+1)}else{l=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"and\""}}}if(m){g.push(m);f+=m.textValue;var n=null;n=this.__consume__and_expression();if(n){g.push(n);f+=n.textValue;j.right=n}else{g=null;this._0=b}}else{g=null;this._0=b}}else{g=null;this._0=b}if(g){this._0=b;var r=this.constructor.SyntaxNode;var u=G(this.constructor,"And");a=new r(f,this._0,g,j);if(typeof u==="object"){k(a,u)}this._0+=f.length}else{a=null}if(a){}else{this._0=h;a=this.__consume__comparison();if(a){}else{this._0=h}}return this._2["and_expression"][e]=a},__consume__comparison:function(c){var a=null,e=this._0;this._2["comparison"]=this._2["comparison"]||{};var d=this._2["comparison"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0;var b=this._0,g=[],j={},f="";var i=null;i=this.__consume__atom();if(i){g.push(i);f+=i.textValue;j.left=i;var m=null;m=this.__consume__comparator();if(m){g.push(m);f+=m.textValue;j.comparator=m;var p=null;p=this.__consume__comparison();if(p){g.push(p);f+=p.textValue;j.right=p}else{g=null;this._0=b}}else{g=null;this._0=b}}else{g=null;this._0=b}if(g){this._0=b;var q=this.constructor.SyntaxNode;var o=G(this.constructor,"Comparison");a=new q(f,this._0,g,j);if(typeof o==="object"){k(a,o)}this._0+=f.length}else{a=null}if(a){}else{this._0=h;a=this.__consume__atom();if(a){}else{this._0=h}}return this._2["comparison"][e]=a},__consume__comparator:function(c){var a=null,e=this._0;this._2["comparator"]=this._2["comparator"]||{};var d=this._2["comparator"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0;var b=null;if(this._1.length>this._0){b=this._1.substring(this._0,this._0+2)}else{b=null}if(b==="!="){var g=this.constructor.SyntaxNode;var j=null;a=new g("!=",this._0,[]);if(typeof j==="object"){k(a,j)}this._0+=2}else{a=null;var f=null;if(this._1.length>this._0){f=this._1.substring(this._0,this._0+1)}else{f=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"!=\""}}}if(a){}else{this._0=h;var i=null;if(this._1.length>this._0){i=this._1.substring(this._0,this._0+1)}else{i=null}if(i==="="){var m=this.constructor.SyntaxNode;var p=null;a=new m("=",this._0,[]);if(typeof p==="object"){k(a,p)}this._0+=1}else{a=null;var q=null;if(this._1.length>this._0){q=this._1.substring(this._0,this._0+1)}else{q=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"=\""}}}if(a){}else{this._0=h}}return this._2["comparator"][e]=a},__consume__atom:function(c){var a=null,e=this._0;this._2["atom"]=this._2["atom"]||{};var d=this._2["atom"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0,b=[],g={},j="";var f=null;f=this.__consume__space();if(f){b.push(f);j+=f.textValue;g.space=f;var i=null;var m=this._0;var p=this._0,q=[],o={},l="";var n=null;var r=null;if(this._1.length>this._0){r=this._1.substring(this._0,this._0+1)}else{r=null}if(r==="("){var u=this.constructor.SyntaxNode;var w=null;n=new u("(",this._0,[]);if(typeof w==="object"){k(n,w)}this._0+=1}else{n=null;var s=null;if(this._1.length>this._0){s=this._1.substring(this._0,this._0+1)}else{s=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"(\""}}}if(n){q.push(n);l+=n.textValue;var t=null;t=this.__consume__expression();if(t){q.push(t);l+=t.textValue;o.in_parens=t;var v=null;var y=null;if(this._1.length>this._0){y=this._1.substring(this._0,this._0+1)}else{y=null}if(y===")"){var z=this.constructor.SyntaxNode;var A=null;v=new z(")",this._0,[]);if(typeof A==="object"){k(v,A)}this._0+=1}else{v=null;var x=null;if(this._1.length>this._0){x=this._1.substring(this._0,this._0+1)}else{x=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\")\""}}}if(v){q.push(v);l+=v.textValue}else{q=null;this._0=p}}else{q=null;this._0=p}}else{q=null;this._0=p}if(q){this._0=p;var B=this.constructor.SyntaxNode;var E=null;i=new B(l,this._0,q,o);if(typeof E==="object"){k(i,E)}this._0+=l.length}else{i=null}if(i){}else{this._0=m;i=this.__consume__value();if(i){}else{this._0=m}}if(i){b.push(i);j+=i.textValue;g.expression=i;var D=null;D=this.__consume__space();if(D){b.push(D);j+=D.textValue;g.space=D}else{b=null;this._0=h}}else{b=null;this._0=h}}else{b=null;this._0=h}if(b){this._0=h;var H=this.constructor.SyntaxNode;var C=G(this.constructor,"Atom");a=new H(j,this._0,b,g);if(typeof C==="object"){k(a,C)}this._0+=j.length}else{a=null}return this._2["atom"][e]=a},__consume__value:function(c){var a=null,e=this._0;this._2["value"]=this._2["value"]||{};var d=this._2["value"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0;a=this.__consume__function_call();if(a){}else{this._0=h;a=this.__consume__string();if(a){}else{this._0=h;a=this.__consume__union_expression();if(a){}else{this._0=h}}}return this._2["value"][e]=a},__consume__function_call:function(c){var a=null,e=this._0;this._2["function_call"]=this._2["function_call"]||{};var d=this._2["function_call"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0,b=[],g={},j="";var f=null;f=this.__consume__function_name();if(f){b.push(f);j+=f.textValue;g.function_name=f;var i=null;var m=null;if(this._1.length>this._0){m=this._1.substring(this._0,this._0+1)}else{m=null}if(m==="("){var p=this.constructor.SyntaxNode;var q=null;i=new p("(",this._0,[]);if(typeof q==="object"){k(i,q)}this._0+=1}else{i=null;var o=null;if(this._1.length>this._0){o=this._1.substring(this._0,this._0+1)}else{o=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"(\""}}}if(i){b.push(i);j+=i.textValue;var l=null;l=this.__consume__function_args();if(l){b.push(l);j+=l.textValue;g.function_args=l;var n=null;var r=null;if(this._1.length>this._0){r=this._1.substring(this._0,this._0+1)}else{r=null}if(r===")"){var u=this.constructor.SyntaxNode;var w=null;n=new u(")",this._0,[]);if(typeof w==="object"){k(n,w)}this._0+=1}else{n=null;var s=null;if(this._1.length>this._0){s=this._1.substring(this._0,this._0+1)}else{s=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\")\""}}}if(n){b.push(n);j+=n.textValue}else{b=null;this._0=h}}else{b=null;this._0=h}}else{b=null;this._0=h}}else{b=null;this._0=h}if(b){this._0=h;var t=this.constructor.SyntaxNode;var v=G(this.constructor,"FunctionCall");a=new t(j,this._0,b,g);if(typeof v==="object"){k(a,v)}this._0+=j.length}else{a=null}return this._2["function_call"][e]=a},__consume__function_name:function(c){var a=null,e=this._0;this._2["function_name"]=this._2["function_name"]||{};var d=this._2["function_name"][e];if(d){this._0+=d.textValue.length;return d}var h=1,b=this._0,g=[],j="",f=true;while(f){var i=null;if(this._1.length>this._0){i=this._1.substring(this._0,this._0+1)}else{i=null}if(i&&/^[a-z\-]/.test(i)){var m=this.constructor.SyntaxNode;var p=null;f=new m(i,this._0,[]);if(typeof p==="object"){k(f,p)}this._0+=1}else{f=null;var q=null;if(this._1.length>this._0){q=this._1.substring(this._0,this._0+1)}else{q=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"[a-z\\-]"}}}if(f){g.push(f);j+=f.textValue;h-=1}}if(h<=0){this._0=b;var o=this.constructor.SyntaxNode;var l=null;a=new o(j,this._0,g);if(typeof l==="object"){k(a,l)}this._0+=j.length}else{a=null}return this._2["function_name"][e]=a},__consume__function_args:function(c){var a=null,e=this._0;this._2["function_args"]=this._2["function_args"]||{};var d=this._2["function_args"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0;var b=this._0,g=[],j={},f="";var i=null;i=this.__consume__expression();if(i){g.push(i);f+=i.textValue;j.first=i;var m=null;var p=0,q=this._0,o=[],l="",n=true;while(n){var r=this._0,u=[],w={},s="";var t=null;var v=null;if(this._1.length>this._0){v=this._1.substring(this._0,this._0+1)}else{v=null}if(v===","){var y=this.constructor.SyntaxNode;var z=null;t=new y(",",this._0,[]);if(typeof z==="object"){k(t,z)}this._0+=1}else{t=null;var A=null;if(this._1.length>this._0){A=this._1.substring(this._0,this._0+1)}else{A=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\",\""}}}if(t){u.push(t);s+=t.textValue;var x=null;x=this.__consume__expression();if(x){u.push(x);s+=x.textValue;w.expression=x}else{u=null;this._0=r}}else{u=null;this._0=r}if(u){this._0=r;var B=this.constructor.SyntaxNode;var E=null;n=new B(s,this._0,u,w);if(typeof E==="object"){k(n,E)}this._0+=s.length}else{n=null}if(n){o.push(n);l+=n.textValue;p-=1}}if(p<=0){this._0=q;var D=this.constructor.SyntaxNode;var H=null;m=new D(l,this._0,o);if(typeof H==="object"){k(m,H)}this._0+=l.length}else{m=null}if(m){g.push(m);f+=m.textValue;j.rest=m}else{g=null;this._0=b}}else{g=null;this._0=b}if(g){this._0=b;var C=this.constructor.SyntaxNode;var I=null;a=new C(f,this._0,g,j);if(typeof I==="object"){k(a,I)}this._0+=f.length}else{a=null}if(a){}else{this._0=h;var J=this.constructor.SyntaxNode;var F=null;a=new J("",this._0,[]);if(typeof F==="object"){k(a,F)}this._0+=0}return this._2["function_args"][e]=a},__consume__string:function(c){var a=null,e=this._0;this._2["string"]=this._2["string"]||{};var d=this._2["string"][e];if(d){this._0+=d.textValue.length;return d}var h=this._0;var b=this._0,g=[],j={},f="";var i=null;var m=null;if(this._1.length>this._0){m=this._1.substring(this._0,this._0+1)}else{m=null}if(m==="'"){var p=this.constructor.SyntaxNode;var q=null;i=new p("'",this._0,[]);if(typeof q==="object"){k(i,q)}this._0+=1}else{i=null;var o=null;if(this._1.length>this._0){o=this._1.substring(this._0,this._0+1)}else{o=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"'\""}}}if(i){g.push(i);f+=i.textValue;var l=null;var n=0,r=this._0,u=[],w="",s=true;while(s){var t=this._0;var v=this._0,y=[],z={},A="";var x=null;var B=null;if(this._1.length>this._0){B=this._1.substring(this._0,this._0+1)}else{B=null}if(B==="\\"){var E=this.constructor.SyntaxNode;var D=null;x=new E("\\",this._0,[]);if(typeof D==="object"){k(x,D)}this._0+=1}else{x=null;var H=null;if(this._1.length>this._0){H=this._1.substring(this._0,this._0+1)}else{H=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"\\\\\""}}}if(x){y.push(x);A+=x.textValue;var C=null;var I=null;if(this._1.length>this._0){I=this._1.substring(this._0,this._0+1)}else{I=null}var J=I;if(J===null){C=null;var F=null;if(this._1.length>this._0){F=this._1.substring(this._0,this._0+1)}else{F=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"<any char>"}}}else{var bm=this.constructor.SyntaxNode;var be=null;C=new bm(J,this._0,[]);if(typeof be==="object"){k(C,be)}this._0+=1}if(C){y.push(C);A+=C.textValue}else{y=null;this._0=v}}else{y=null;this._0=v}if(y){this._0=v;var bf=this.constructor.SyntaxNode;var P=null;s=new bf(A,this._0,y,z);if(typeof P==="object"){k(s,P)}this._0+=A.length}else{s=null}if(s){}else{this._0=t;var R=null;if(this._1.length>this._0){R=this._1.substring(this._0,this._0+1)}else{R=null}if(R&&/^[^']/.test(R)){var bg=this.constructor.SyntaxNode;var L=null;s=new bg(R,this._0,[]);if(typeof L==="object"){k(s,L)}this._0+=1}else{s=null;var Y=null;if(this._1.length>this._0){Y=this._1.substring(this._0,this._0+1)}else{Y=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"[^']"}}}if(s){}else{this._0=t}}if(s){u.push(s);w+=s.textValue;n-=1}}if(n<=0){this._0=r;var bn=this.constructor.SyntaxNode;var Z=null;l=new bn(w,this._0,u);if(typeof Z==="object"){k(l,Z)}this._0+=w.length}else{l=null}if(l){g.push(l);f+=l.textValue;var M=null;var N=null;if(this._1.length>this._0){N=this._1.substring(this._0,this._0+1)}else{N=null}if(N==="'"){var bo=this.constructor.SyntaxNode;var ba=null;M=new bo("'",this._0,[]);if(typeof ba==="object"){k(M,ba)}this._0+=1}else{M=null;var bh=null;if(this._1.length>this._0){bh=this._1.substring(this._0,this._0+1)}else{bh=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"'\""}}}if(M){g.push(M);f+=M.textValue}else{g=null;this._0=b}}else{g=null;this._0=b}}else{g=null;this._0=b}if(g){this._0=b;var bi=this.constructor.SyntaxNode;var bw=null;a=new bi(f,this._0,g,j);if(typeof bw==="object"){k(a,bw)}this._0+=f.length}else{a=null}if(a){var bx=G(this.constructor,"String");if(typeof bx==="object"){k(a,bx)}}else{this._0=h;var bj=this._0,Q=[],bR={},bb="";var S=null;var bp=null;if(this._1.length>this._0){bp=this._1.substring(this._0,this._0+1)}else{bp=null}if(bp==="\""){var bS=this.constructor.SyntaxNode;var by=null;S=new bS("\"",this._0,[]);if(typeof by==="object"){k(S,by)}this._0+=1}else{S=null;var bz=null;if(this._1.length>this._0){bz=this._1.substring(this._0,this._0+1)}else{bz=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"\\\"\""}}}if(S){Q.push(S);bb+=S.textValue;var T=null;var bA=0,bT=this._0,bB=[],bq="",K=true;while(K){var bC=this._0;var br=this._0,U=[],bU={},bk="";var V=null;var bs=null;if(this._1.length>this._0){bs=this._1.substring(this._0,this._0+1)}else{bs=null}if(bs==="\\"){var bV=this.constructor.SyntaxNode;var bD=null;V=new bV("\\",this._0,[]);if(typeof bD==="object"){k(V,bD)}this._0+=1}else{V=null;var bE=null;if(this._1.length>this._0){bE=this._1.substring(this._0,this._0+1)}else{bE=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"\\\\\""}}}if(V){U.push(V);bk+=V.textValue;var W=null;var bt=null;if(this._1.length>this._0){bt=this._1.substring(this._0,this._0+1)}else{bt=null}var bF=bt;if(bF===null){W=null;var bG=null;if(this._1.length>this._0){bG=this._1.substring(this._0,this._0+1)}else{bG=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"<any char>"}}}else{var bW=this.constructor.SyntaxNode;var bH=null;W=new bW(bF,this._0,[]);if(typeof bH==="object"){k(W,bH)}this._0+=1}if(W){U.push(W);bk+=W.textValue}else{U=null;this._0=br}}else{U=null;this._0=br}if(U){this._0=br;var bX=this.constructor.SyntaxNode;var bI=null;K=new bX(bk,this._0,U,bU);if(typeof bI==="object"){k(K,bI)}this._0+=bk.length}else{K=null}if(K){}else{this._0=bC;var bc=null;if(this._1.length>this._0){bc=this._1.substring(this._0,this._0+1)}else{bc=null}if(bc&&/^[^"]/.test(bc)){var bY=this.constructor.SyntaxNode;var bJ=null;K=new bY(bc,this._0,[]);if(typeof bJ==="object"){k(K,bJ)}this._0+=1}else{K=null;var bK=null;if(this._1.length>this._0){bK=this._1.substring(this._0,this._0+1)}else{bK=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"[^\"]"}}}if(K){}else{this._0=bC}}if(K){bB.push(K);bq+=K.textValue;bA-=1}}if(bA<=0){this._0=bT;var bZ=this.constructor.SyntaxNode;var bL=null;T=new bZ(bq,this._0,bB);if(typeof bL==="object"){k(T,bL)}this._0+=bq.length}else{T=null}if(T){Q.push(T);bb+=T.textValue;var X=null;var bu=null;if(this._1.length>this._0){bu=this._1.substring(this._0,this._0+1)}else{bu=null}if(bu==="\""){var ca=this.constructor.SyntaxNode;var bM=null;X=new ca("\"",this._0,[]);if(typeof bM==="object"){k(X,bM)}this._0+=1}else{X=null;var bN=null;if(this._1.length>this._0){bN=this._1.substring(this._0,this._0+1)}else{bN=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\"\\\"\""}}}if(X){Q.push(X);bb+=X.textValue}else{Q=null;this._0=bj}}else{Q=null;this._0=bj}}else{Q=null;this._0=bj}if(Q){this._0=bj;var cb=this.constructor.SyntaxNode;var bO=null;a=new cb(bb,this._0,Q,bR);if(typeof bO==="object"){k(a,bO)}this._0+=bb.length}else{a=null}if(a){var bP=G(this.constructor,"String");if(typeof bP==="object"){k(a,bP)}}else{this._0=h}}return this._2["string"][e]=a},__consume__space:function(c){var a=null,e=this._0;this._2["space"]=this._2["space"]||{};var d=this._2["space"][e];if(d){this._0+=d.textValue.length;return d}var h=0,b=this._0,g=[],j="",f=true;while(f){var i=null;if(this._1.length>this._0){i=this._1.substring(this._0,this._0+1)}else{i=null}if(i===" "){var m=this.constructor.SyntaxNode;var p=null;f=new m(" ",this._0,[]);if(typeof p==="object"){k(f,p)}this._0+=1}else{f=null;var q=null;if(this._1.length>this._0){q=this._1.substring(this._0,this._0+1)}else{q=null}if(!this.error||this.error.offset<=this._0){this.error=this.constructor.lastError={input:this._1,offset:this._0,expected:"\" \""}}}if(f){g.push(f);j+=f.textValue;h-=1}}if(h<=0){this._0=b;var o=this.constructor.SyntaxNode;var l=null;a=new o(j,this._0,g);if(typeof l==="object"){k(a,l)}this._0+=j.length}else{a=null}return this._2["space"][e]=a}};var O=function(c){this._1=c;this._0=0;this._2={}};O.prototype.parse=function(){var c=this.__consume__union_expression();if(c&&this._0===this._1.length){return c}if(!(this.error)){this.error={input:this._1,offset:this._0,expected:"<EOF>"}}var a=bl(this.error);var e=new Error(a);throw e;};O.parse=function(c){var a=new O(c);return a.parse()};k(O.prototype,bd);var bQ=function(c,a,e,d){this.textValue=c;this.offset=a;this.elements=e||[];if(!d)return;for(var h in d)this[h]=d[h]};bQ.prototype.forEach=function(c,a){for(var e=0,d=this.elements.length;e<d;e++){c.call(a,this.elements[e],e)}};O.SyntaxNode=bQ;if(typeof require==="function"&&typeof exports==="object"){exports.Grammar=bd;exports.Parser=O;exports.parse=O.parse;if(typeof Pathology!=="undefined"){Pathology.XPath=bd;Pathology.XPathParser=O;Pathology.XPathParser.formatError=bl}}else{var bv=this;bv=bv.Pathology=bv.Pathology||{};Pathology.XPath=bd;Pathology.XPathParser=O;Pathology.XPathParser.formatError=bl}})();Pathology.XPathParser.And={evaluate:function(c,a){return Pathology.atomize(this.left,c,a)&&Pathology.atomize(this.right,c,a)}};Pathology.XPathParser.Atom={evaluate:function(c,a){var e=this.expression.in_parens||this.expression;return e.evaluate(c,a)}};Pathology.Axis=function(c){this.name=c};Pathology.Axis.prototype.walk=function(c,a,e){var d=c.childNodes,h=Pathology.array(c.attributes);if(c.checked)h.push({nodeName:'checked',nodeValue:true,nodeType:XPathResult.STRING_TYPE});if(c.selected)h.push({nodeName:'selected',nodeValue:true,nodeType:XPathResult.STRING_TYPE});switch(this.name){case'attribute':for(var b=0,g=h.length;b<g;b++){a.call(e,h[b])}break;case'parent':a.call(e,c.parentNode);break;case'self':a.call(e,c);break;case'descendant-or-self':a.call(e,c);for(var b=0,g=d.length;b<g;b++){this.walk(d[b],a,e)}break;case'child':for(var b=0,g=d.length;b<g;b++){a.call(e,d[b])}break}};Pathology.Axis.SHORTHANDS={'@':'attribute','..':'parent','.':'self','/':'descendant-or-self','':'child'};Pathology.Axis.fromAST=function(c){var a=c.axis_name?c.axis_name.textValue:c.textValue;return new this(this.SHORTHANDS[a]||a)};Pathology.XPathParser.Comparison={evaluate:function(a,e){var d=this.comparator.textValue,h=this.left.evaluate(a,e),b=Pathology.atomize(this.right,a,e);if(h.forEach){var g=false;h.forEach(function(c){switch(d){case'=':g=g||(b instanceof Array?b.indexOf(c.nodeValue)>=0:c.nodeValue==b);break;case'!=':g=g||(b instanceof Array?b.indexOf(c.nodeValue)<0:c.nodeValue!=b);break}});return g}else{switch(d){case'=':return b instanceof Array?b.indexOf(h.nodeValue)>=0:h==b;case'!=':return b instanceof Array?b.indexOf(node.nodeValue)<0:h!=b}}}};Pathology.XPathParser.FunctionCall={getArguments:function(a,e){var d=[];if(this.function_args.first&&this.function_args.first.evaluate){d.push(this.function_args.first.evaluate(a,e))}if(this.function_args.rest){this.function_args.rest.forEach(function(c){d.push(c.expression.evaluate(a,e))})}return d},evaluate:function(c,a){var e=this.getArguments(c,a),d=this.REGISTER[this.function_name.textValue];return d.apply(c,e)},REGISTER:{'concat':function(){return Array.prototype.join.call(arguments,"")},'contains':function(c,a){if(!c)return false;if(c.makeString)c=c.makeString();return c.toString().indexOf(a)>=0},'normalize-space':function(c){if(c.makeString)c=c.makeString();return c.toString().replace(/^\s*/g,'').replace(/\s*$/g,'').replace(/\s+/g,' ')},'name':function(){return this.nodeName.toLowerCase()},'not':function(c){if(c&&c.atomize)c=c.atomize();if(typeof c==='string')return false;return!c},'string':function(c){return c.atomize().innerText},'text':function(){return document.evaluate('/text()',this,null,XPathResult.ANY_TYPE,null)}}};Pathology.XPathParser.LocationPath={eachStep:function(c,a){c.call(a,this.head);this.rest.forEach(c,a)},evaluate:function(d,h,b,g){g=g||new Pathology.XPathResult(XPathResult.ANY_TYPE);b=b||XPathResult.ANY_TYPE;var j=new Pathology.XPathResult(b),f=this.head.isRelative()?d:h;j.push(f);this.eachStep(function(a){var e=new Pathology.XPathResult(b);j.forEach(function(c){a.evaluate(c,h,b,e)});j=e});j.forEach(g.push,g);return g}};Pathology.XPathParser.LocationStep={isRelative:function(){return this.elements[0].textValue!=='/'},evaluate:function(a,e,d,h){var b=this.selector.axis,g=this.selector.test;Pathology.Axis.fromAST(b).walk(a,function(c){if(!g||!g.evaluate)return h.push(c);g.evaluate(c,this.predicates,e,d,h)},this)}};Pathology.XPathParser.NodeTest={evaluate:function(a,e,d,h,b){var g=this.condition_name;if(g&&g.textValue==='node'){}else if(g&&g.textValue==='text'){if(a.nodeType!==XPathResult.BOOLEAN_TYPE)return}else{var j=this.textValue.toLowerCase();if(j==='*'){if(a.nodeType!==1)return}else{if(!a.nodeName)return;if(a.nodeName.toLowerCase()!==j)return}}var f=true;e.forEach(function(c){f=f&&Pathology.atomize(c.expression,a,d);if(typeof f==='string')f=true});if(f)b.push(a)}};Pathology.XPathParser.Or={evaluate:function(c,a){return Pathology.atomize(this.left,c,a)||Pathology.atomize(this.right,c,a)}};Pathology.XPathParser.String={evaluate:function(c,a){return eval(this.textValue)}};Pathology.XPathParser.Union={eachPath:function(a,e){a.call(e,this.head);this.rest.forEach(function(c){a.call(e,c.location_path)})},evaluate:function(a,e,d,h){h=h||new Pathology.XPathResult(XPathResult.ANY_TYPE);d=d||XPathResult.ANY_TYPE;this.eachPath(function(c){c.evaluate(a,e,d,h)});return h}};
//@ sourceMappingURL=pathology-min.js.map